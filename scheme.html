<!doctype html>
<html>
  <head>
	<title>Mohamed Elgharbawy</title>
	<link rel="stylesheet" href="css/xterm.css"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script>

	<!-- Favicons -->
	<link href="img/m.png" rel="icon">
	<link href="img/m.png" rel="apple-touch-icon">
  </head>
  <body>
	<div id="terminal"></div>
	<script>
	  var curr_line = '';
	  var entries = [];
	  var currPos = 0;
	  
	  var term = new Terminal({cursorBlink: "block"});
	  term.open(document.getElementById('terminal'));
	  term.prompt = () => {
		term.write('\n\r' + curr_line + '\r\nscm> ');
	  };
	  term.write('Welcome to my Scheme web intepreter!');
	  term.prompt();

	  term.on('key', function(key, ev) {
		const printable = !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey;

		if (ev.keyCode === 13) {	// Enter key
		  if (curr_line != ''){
			entries.push(curr_line);
		  	currPos = entries.length - 1;
			term.prompt();
		  	curr_line = '';
		  } else {
			term.write('\n\rscm> ');
		  }
		} else if (ev.keyCode === 8) {	// Backspace
		  if (term.buffer.cursorX > 5) {
			curr_line = curr_line.slice(0, -1);
			term.write('\b \b');
		  }
		} else if (ev.keyCode === 38) {	// Up Arrow
		  if (entries.length > 0) {
			curr_line = entries[currPos];
		  	term.write('\33[2K\rscm> ' + curr_line);
			if (currPos > 0) {
			  currPos -= 1;
			}
		  }
		} else if (ev.keyCode === 40) {	// Down arrow
			currPos += 1;
			if (currPos === entries.length || entries.length === 0) {
				currPos -= 1;
				term.write('\33[2K\rscm> ');
			} else {
				curr_line = entries[currPos];
				term.write('\33[2K\rscm> ' + curr_line);
			}
		} else if (printable) {
		  curr_line += ev.key;
		  term.write(key);
		}
	  });

	  term.on('paste', function(data) {
		curr_line += data;
		term.write(curr_line);
	  });
	</script>
  </body>
</html>